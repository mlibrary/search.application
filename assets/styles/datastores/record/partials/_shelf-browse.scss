@use '../../../colors';
@use '../../../forms';
@use '../../../icons';
@use '../../../media';
@use '../../../utilities';

// --------------------------------------------------
//
// # Record
//   Styles to apply directly to `views/datastores/record/partials/_shelf-browse.erb`.
//
// ## Table of Contents
//   1. Variables and Mixins
//     1.1. Variables
//     1.2. Mixins
//   2. Container
//   3. Header
//   4. Carousel
//   5. Return to Current Record
//
// --------------------------------------------------

// ******************************* //
// *** 1. VARIABLES AND MIXINS *** //
// ******************************* //

// *               * //
// * 1.1 VARIABLES * //
// *               * //

$class: 'shelf-browse';



// *            * //
// * 1.2 MIXINS * //
// *            * //

@mixin carouselAnimation($fade: Out, $direction: Left) {
  animation:
    0.25s ease-in-out fade#{$fade} forwards,
    0.25s ease-in-out slide#{$fade}From#{$direction} forwards;
}





// ******************** //
// *** 2. CONTAINER *** //
// ******************** //

.#{$class} {
  display: grid;
  gap: 1rem;
  grid-template-areas:
    "header"
    "carousel"
    "return";
  grid-template-columns: auto;
  grid-template-rows: auto;
  padding: 1rem;
  @include media.breakpoint('xs') {
    grid-template-areas:
      "header return"
      "carousel carousel";
    grid-template-columns: 1fr auto;
  }
  @media print {
    display: none;
  }
}





// ***************** //
// *** 3. HEADER *** //
// ***************** //

.#{$class} > .#{$class}__header {
  @include utilities.flex($wrap: true);
  & {
    grid-area: header;
  }
  h2 {
    margin: 0;
  }
  a.#{$class}__header--link {
    &:before {
      @include icons.icon($icon: "list");
      & {
        font-size: 1.25rem;
        line-height: 1;
        margin-right: 0.25rem;
      }
    }
  }
}





// ******************* //
// *** 4. CAROUSEL *** //
// ******************* //

.#{$class} > .#{$class}__carousel {
  display: grid;
  gap: 1rem;
  grid-area: carousel;
  grid-template-areas: "prev list next";
  grid-template-columns: auto 1fr auto;
  grid-template-rows: auto;
}



// *             * //
// * 4.1 BUTTONS * //
// *             * //

.#{$class} > .#{$class}__carousel > .#{$class}__carousel--button {
  @include forms.button;
  & {
    color: colors.$color-anchor;
  }
  &:first-of-type {
    grid-area: prev;
  }
  &:last-of-type {
    grid-area: next;
  }
  .material-symbols-rounded {
    font-size: 2rem;
  }
}



// *           * //
// * 4.2 ITEMS * //
// *           * //

.#{$class} > .#{$class}__carousel > .#{$class}__carousel--items {
  & {
    display: grid;
    column-gap: 1rem;
    font-size: 0.75rem;
    font-variation-settings: "wdth" 87.5;
    grid-area: list;
    grid-template-columns: repeat(1, 1fr);
    grid-template-rows: 2.5rem auto;
    position: relative;
    & > li {
      grid-row: 3 / 2;
      &.highlighted-record {
        grid-row: 3 / 1;
        & > a {
          border: 4px solid var(--search-color-blue-500);
        }
      }
      & .current-record__badge {
        align-self: baseline;
        background: var(--search-color-blue-500);
        -webkit-clip-path: polygon(0 0, 100% 0, calc(100% - .75rem) 50%, 100% 100%, 0 100%);
        clip-path: polygon(0 0, 100% 0, calc(100% - .75rem) 50%, 100% 100%, 0 100%);
        color: #fff;
        font-size: .5rem;
        letter-spacing: 1px;
        margin-left: calc(-.75rem - 1px);
        margin-top: 0;
        padding: .5rem 1.25rem .5rem .5rem;
        text-transform: uppercase;
      }
      & > a {
        color: inherit;
        display: block;
        height: 100%;
        padding: 0.5rem 0.75rem;
        text-decoration: none;
        &:hover dd.strong {
          text-decoration: underline;
          text-decoration-thickness: 0.125rem;
        }
        .material-symbols-rounded {
          color: colors.$color-anchor;
        }
      }
      &.animation-out-next {
        @include carouselAnimation;
      }
      &.animation-out-previous {
        @include carouselAnimation($direction: Right);
      }
      &.animation-in-next {
        @include carouselAnimation($fade: In, $direction: Right);
      }
      &.animation-in-previous {
        @include carouselAnimation($fade: In);
      }
      @media (prefers-reduced-motion) {
        &[class*="animation-"] {
          animation: none;
        }
      }
      dl {
        @include utilities.flex($align: stretch);
        & {
          flex-direction: column;
        }
        dd {
          display: -webkit-box;
          -webkit-line-clamp: 3;
          -webkit-box-orient: vertical;
          margin: 0;
          overflow: hidden;
          overflow-wrap: anywhere;
          &.strong {
            color: colors.$color-anchor;
            text-decoration: underline;
          }
        }
      }
    }
  }
  @include media.breakpoint('xs') {
    grid-template-columns: repeat(3, 1fr);
    &[data-current-page="0"] {
      &[data-first-page-difference="1"] {
        & > li:nth-child(1) {
          grid-column: 2;
        }
        & > li:nth-child(2) {
          grid-column: 3;
        }
      }
      &[data-first-page-difference="2"] {
        & > li:nth-child(1) {
          grid-column: 3;
        }
      }
    }
  }
  @include media.breakpoint('sm') {
    grid-template-columns: repeat(5, 1fr);
    &[data-current-page="0"] {
      &[data-first-page-difference="1"] {
        & > li:nth-child(1) {
          grid-column: 2;
        }
        & > li:nth-child(2) {
          grid-column: 3;
        }
        & > li:nth-child(3) {
          grid-column: 4;
        }
        & > li:nth-child(4) {
          grid-column: 5;
        }
      }
      &[data-first-page-difference="2"] {
        & > li:nth-child(1) {
          grid-column: 3;
        }
        & > li:nth-child(2) {
          grid-column: 4;
        }
        & > li:nth-child(3) {
          grid-column: 5;
        }
      }
      &[data-first-page-difference="3"] {
        & > li:nth-child(1) {
          grid-column: 4;
        }
        & > li:nth-child(2) {
          grid-column: 5;
        }
      }
      &[data-first-page-difference="4"] {
        & > li:nth-child(1) {
          grid-column: 5;
        }
      }
    }
  }
}

// * 4.2.1 CURRENT RECORD * //

body.no-javascript .#{$class} > .#{$class}__carousel > .#{$class}__carousel--items {
  // SET MAX WIDTH FOR RECORD
  & > li:not(.current-record) {
    display: none;
  }
}

// * 4.2.2 ANIMATIONS * //

@keyframes slideInFromLeft {
  from {
    transform: translateX(-1rem);
  }
  to {
    transform: translateX(0);
  }
}

@keyframes slideInFromRight {
  from {
    transform: translateX(1rem);
  }
  to {
    transform: translateX(0);
  }
}

@keyframes slideOutFromLeft {
  from {
    transform: translateX(0);
  }
  to {
    transform: translateX(-1rem);
  }
}

@keyframes slideOutFromRight {
  from {
    transform: translateX(0);
  }
  to {
    transform: translateX(1rem);
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes fadeOut {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}




// *********************************** //
// *** 5. RETURN TO CURRENT RECORD *** //
// *********************************** //

.#{$class} > .#{$class}__return {
  align-self: center;
  grid-area: return;
  justify-self: center;
}
